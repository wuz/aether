-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

#!/bin/sh
<<\EOF
<!--
  Test
  - -->
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <title>setup.wuz.sh - A setup script for my computer, way overengineered.</title>
      <meta name="viewport" content="initial-scale = 1, maximum-scale=1, user-scalable = 0"/>
      <meta name="apple-mobile-web-app-capable" content="yes"/>
      <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
      <meta name="HandheldFriendly" content="true"/>
      <meta name="MobileOptimized" content="320"/>
      <style>
*,*:before,*:after{box-sizing:border-box;} html{background:#191b2a;color:#191b2a;font-family:monospace;font-size:16px;} *{text-indent:-9999px;} body{margin:0;padding:0;display:flex;align-items:center;justify-content:center;color:#eff0f6;overflow:hidden;width:100vw;height:100vh;top:0px;right:0px;display:flex;justify-content:center;align-items:center;} article{padding:30px 50px;max-height:100vh;height:100vh;max-width:600px;width:100%;overflow-y:auto;} article *{text-indent:0px;} a{color:#eff0f6;text-decoration:none;} article * + *{margin-bottom:0.5em;} pre{text-align:left;line-height:1.1;} ol{padding:0;margin:0;} ol li + li{margin-bottom:1em;} code{margin:0.5em 0;padding:10px 5px;background:#3c4367;display:block;border-bottom:1px solid #4f5987;text-align:left;border-radius:2px;} code:before{content:"$ ";color:#ff476e;}       </style>
    </head>
    <body>
      <article>
        <h1>setup.wuz.sh</h1>
        <strong>Download and verify integrity with GnuPG:</strong>
        <ol>
          <li>Import my keys (you can verify keybase.io/wuz as me by visiting the site!)
            <code>curl https://keybase.io/wuz/pgp_keys.asc | gpg --import</code></li>
          <li>Open up GPG and let it know that you trust my keys (0xCAA69BFC5EF24C40 is my key)
            <code>gpg --edit-key 0xCAA69BFC5EF24C40</code>
            <code>trust</code>
            <li>At this point, you need to decide how much you trust me, represented from 1-5
              You probably don't trust me ultimately - that should just be reserved for you.
              If, in looking at my keybase, you think I am pretty trustworthy, you can set my trust level to 4.
              You can read more about what each trust level means <a href="https://www.gnupg.org/gph/en/manual/x334.html">here</a>
              <code> 4</code></li>
          </li>
          <li>Recieve the keys from a keyserver
            <code>gpg --recv-keys 0xCAA69BFC5EF24C40</code></li>
          <li>Verify that this code is actually signed by me. Don't forget, `https` is really important here!
            <code> curl https://setup.wuz.sh | gpg -o setup.wuz.sh</code></li>
        </ol>

        Don't pipe to `sh` in the previous step -
        you don't know if the signature is valid
        or what the source code is doing.

        <strong>Inspect source code</strong>
        <code> less setup.wuz.sh</code>

        <strong>Run</strong>
        <code> chmod +x setup.wuz.sh</code>
        <code> ./setup.wuz.sh</code>
      </article>
    </body>
  </html>
  <!--
    EOF

#!/bin/bash

#__/\\\______________/\\\_____________________________        
# _\/\\\_____________\/\\\_____________________________       
#  _\/\\\_____________\/\\\_____________________________      
#   _\//\\\____/\\\____/\\\___/\\\____/\\\__/\\\\\\\\\\\_     
#    __\//\\\__/\\\\\__/\\\___\/\\\___\/\\\_\///////\\\/__    
#     ___\//\\\/\\\/\\\/\\\____\/\\\___\/\\\______/\\\/____   
#      ____\//\\\\\\//\\\\\_____\/\\\___\/\\\____/\\\/______  
#       _____\//\\\__\//\\\______\//\\\\\\\\\___/\\\\\\\\\\\_ 
#        ______\///____\///________\/////////___\///////////__
#

# This is my[1] setup script - it's heavily adapted to my usecases
# The code is CC0[2] so feel free to rework and reuse as you see fit.
# Extensively inspired and reworked from: https://github.com/nnja/new-computer

dontask=false

####################
# Helper functions #
####################

# Colorize

# Set the colours you can use
black=$(tput setaf 0)
red=$(tput setaf 1)
green=$(tput setaf 2)
yellow=$(tput setaf 3)
blue=$(tput setaf 4)
magenta=$(tput setaf 5)
cyan=$(tput setaf 6)
white=$(tput setaf 7)
reset=$(tput sgr0) # Resets the style

show_spinner()
{
  local -r pid="${1}"
  local -r delay='0.5'
  SYMBOLS='⣾ ⣽ ⣻ ⢿ ⡿ ⣟ ⣯ ⣷'
  SPINNER_PPID=$(ps -p "${pid}" -o ppid=)
  while ps a | awk '{print $1}' | grep -q "${pid}"; do
    tput civis
    for c in ${SYMBOLS}; do
      local COLOR
      COLOR=$(tput setaf 5)
      tput sc
      env printf "${COLOR}${c}${SPINNER_NORMAL}"
      tput rc
      env sleep .2
      if [ ! -z "$SPINNER_PPID" ]; then
        SPINNER_PARENTUP=$(ps $SPINNER_PPID)
        if [ -z "$SPINNER_PARENTUP" ]; then
          break 2
        fi
      fi
    done
  done
  tput cnorm
}

spinner() {
  ("$@") &
  show_spinner "$!"
}

# Color-echo. Improved. [Thanks @joaocunha]
# arg $1 = message
# arg $2 = Color
cecho() {
  echo "${2}${1}${reset}"
  return
}

# arg $1 = question
# arg $2 = custom denied message
confirm () {
  if [[ $dontask ]]; then
    return 1
  fi
  read -e -p "${white}[confirm] ${blue}${1} : (Y/N) > ${reset}" OK
  if ! [[ "$OK" =~ ^([yY][eE][sS]|[yY])$ ]]
  then
    if ! [[ "$OK" =~ ^([nN][oO]|[nN])$ ]]
    then
      confirm "$1"
    else
      if [[  $2 ]]
      then
        cecho "$2" $yellow
      else
        cecho "Ok! We'll stop here!" $yellow
      fi
      exit 0
    fi
  fi
}

speak() {
  if [[ $dontask ]]; then
    return 1
  fi
  cecho "[◕ᴥ◕] > ${1}" $green
}

while getopts :y flag
do
  case "${flag}" in
      y) dontask=true;;
  esac
done

if [[ $dontask ]]; then
  cecho "Running with -y, ignoring interactive installation" $red
fi

echo ""
cecho "###############################################" "$red"
cecho "#        THIS IS CURRENTLY ONLY FOR MAC       #" "$red"
cecho "#                                             #" "$red"
cecho "#---------------------------------------------#" "$red"
cecho "#                                             #" "$red"
cecho "#        DON'T RUN CODE YOU FIND ON THE       #" "$red"
cecho "#      INTERNET WITHOUT READING IT FIRST      #" "$red"
cecho "#        YOU'LL EVENTUALLY REGRET IT...       #" "$red"
cecho "#                                             #" "$red"
cecho "#---------------------------------------------#" "$red"
cecho "#                                             #" "$red"
cecho "#          READ THIS CODE THOROUGHLY          #" "$red"
cecho "#         AND EDIT TO SUIT YOUR NEEDS         #" "$red"
cecho "###############################################" "$red"
echo ""


speak "It looks like you're trying to set up a new computer... Just kidding. I'm your friendly installer script!"
speak "This script is interactive! Before doing anything, we'll make sure to ask if it's ok, like this:"
confirm "Is it ok to get started?"
speak "Perfect! Let's do this!"

speak "First things first, have you read over the script? Definitely don't run something from the web without reading it first!"
confirm "Have you read over the script?" "Go check it out and then run this again!"


speak "Alright, now we need sudo to keep this thing running. We'll ask for your password now, ok?"
confirm "OK to ask for sudo?"
## Here we go.. ask for the administrator password upfront
sudo -v
## Run a keep-alive to update existing `sudo` time stamp until script has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

speak "This script runs primarily on nix. Can we install Nix now?"
confirm "OK to install Nix and setup the needed directories and nix channels?"
curl -L https://nixos.org/nix/install | sh
mkdir -p ~/.config/nix/ ~/.config/nixpkgs/
echo 'max-jobs = auto' >>~/.config/nix/nix.conf
nix-channel --add https://nixos.org/channels/nixos-unstable nixpkgs
nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
nix-channel --add https://github.com/kwbauson/cfg/archive/main.tar.gz kwbauson-cfg
nix-channel --update
nix-shell '<home-manager>' -A install

speak "Cool, let's set up xcode tools so that we have access to git."
confirm "OK to install xcode tools (xcode-select --install)?"
xcode-select --install
if [ $? -eq 0 ]; then
sleep 1
osascript <<EOF
  tell application "System Events"
    tell process "Install Command Line Developer Tools"
      keystroke return
      click button "Agree" of window "License Agreement"
    end tell
  end tell
EOF
fi

speak "Once that is done installing, press any key to continue!"
while [ true ] ; do
  read -t 3 -n 1
  if [ $? = 0 ] ; then
    break;
  else
    speak "Waiting for the keypress "
  fi
done

speak "Alright! Nix is install and setup with what we need! Now let's pull down the nix config files."
confirm "OK to pull the files we need (git.sr.ht/~wuz/nix -> ~/.config/nixpkgs)?"
git clone git@git.sr.ht:~wuz/nix ~/.config/nixpkgs
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEf0+WKJ8uCVZxOxjcyqab/F7yTEAFAmCYZG0ACgkQyqab/F7y
TEDoKQ//SgnlvdxLWCgYgjlzyF0uu16p4tWR2fB9w3qR2xG69Fc/YDdwNFAyifPe
uxI6x4aIYdZ1ohQC5Y5pm7+22C9pnmcL34aJ/lN1ZnSHSntXNcPHtPhh/o+DnnBl
zLhP2nfNYrrOFStEgV8dYsaxpgkrvdgk9ZNVd0v/mOpNlBBjjOyXg+MDjFtD8JO7
vz36WJT6leZldMXYw//noB2ISLInWATol5QH0Acn1nJhvrTJMZsVyuo+ZDtYV89F
4A9XRb1VDLy0dPcwhxcGrkopyI5hOEWohjk4nrzs+kL/CM+Q6UhVc/mGhhLgZIx5
UKsHHLZ5tf3MXCtv2dbma0oIjCPfqz4xbvnLJCjH2BnpaGlYYShSO8i/JDC5BEdf
pBVRNGpopmYJ7Whz1vCfWKk9uPwECVz/Ve9THgN/6QEQxYX/rSgveHkUVpdM+qLt
n2e4A0bpCx/MFWs2NJnnZjT4pUt5vppl3jTeIgjCyaeua60itAoyAVnQi0ZvHJfx
97QnaHXSpwAXGJqeWaRgiRsSHmanxGCu1VMEHGLyxv4s8MJxrXy2PjPvSQAbqZYf
D9XFQhA/bzJI7f88FGD+SRy3Q1QrzUi5u//AkuO+/k+oWaCFbdjtI49bvy2JfFoM
5PHCRkmzehTaTIYsosVXdeBbS8FXGqAvkq1jS8Fsw5Z9o6PHQ/Q=
=b78Z
-----END PGP SIGNATURE-----
